# OceaGPX - 実装計画

## 実装ルール

### フェーズ移行ルール

1. **各フェーズ完了時に確認依頼**を行う
2. ユーザーが**動作確認**を実施
3. ユーザーの**承認後**に次フェーズへ移行
4. 問題があれば**修正してから再確認**

### 確認フロー

```
実装完了 → 確認依頼 → ユーザー確認 → 承認/修正依頼 → 次フェーズ or 修正
```

---

## フェーズ1: プロジェクト基盤

### 目標
Electronアプリの基本構造を構築し、ウィンドウが表示されることを確認

### 実装内容

- [ ] プロジェクト初期化（package.json, tsconfig.json）
- [ ] Electron + TypeScript + React + MUI のセットアップ
- [ ] Webpackビルド設定
- [ ] メインプロセス・レンダラープロセス・プリロードの基本構造
- [ ] 基本的なウィンドウ表示（タイトル「OceaGPX」）
- [ ] 開発用npm scripts（dev, build）

### 確認ポイント

| # | 確認項目 | 確認方法 |
|---|---------|---------|
| 1 | `npm run dev` でアプリが起動する | コマンド実行 |
| 2 | ウィンドウが表示される | 目視確認 |
| 3 | タイトルが「OceaGPX」になっている | 目視確認 |
| 4 | MUIコンポーネントが表示される | 目視確認（ボタン等） |

### 成果物
- 起動可能なElectronアプリ（空のUI）

---

## フェーズ2: データベース読み込み・一覧表示

### 目標
DBファイルを選択し、記録一覧をテーブル表示する

### 実装内容

- [ ] better-sqlite3 の導入
- [ ] DBファイル選択ダイアログ（ファイルダイアログ）
- [ ] DBファイルのドラッグ&ドロップ対応
- [ ] LCHFILテーブルの読み込み
- [ ] LOCFILのポイント数カウント（JOIN）
- [ ] MUI DataGridで記録一覧表示
- [ ] ソート機能（デフォルト：新しい順）
- [ ] フィルタ機能（記録名検索）
- [ ] 複数選択チェックボックス
- [ ] 全選択 / 全解除ボタン
- [ ] 選択したDBパスの記憶（electron-store）

### 確認ポイント

| # | 確認項目 | 確認方法 |
|---|---------|---------|
| 1 | 「選択...」ボタンでDBファイルを選択できる | ボタンクリック |
| 2 | D&DでDBファイルを読み込める | ファイルをドロップ |
| 3 | 記録一覧が正しく表示される | 目視確認（79件） |
| 4 | 記録名、開始日時、終了日時、航行距離、ポイント数が表示される | 目視確認 |
| 5 | カラムクリックでソートできる | カラムヘッダクリック |
| 6 | 記録名でフィルタできる | 検索ボックス入力 |
| 7 | チェックボックスで複数選択できる | チェック操作 |
| 8 | 全選択/全解除が動作する | ボタンクリック |
| 9 | アプリ再起動後もDBパスが記憶されている | 再起動して確認 |

### 成果物
- DBファイルを読み込み、記録一覧を表示するアプリ

---

## フェーズ3: 地図プレビュー

### 目標
選択した記録の航跡を地図上に表示する

### 実装内容

- [ ] Leaflet + React-Leaflet の導入
- [ ] OpenStreetMapタイル表示
- [ ] 選択した記録のLOCFILデータ取得
- [ ] 航跡のポリライン描画
- [ ] 複数選択時の色分け表示
- [ ] 開始・終了点のマーカー表示
- [ ] 選択した航跡に自動フィット（bounds調整）
- [ ] 大量ポイント時の間引き処理（Douglas-Peucker）

### 確認ポイント

| # | 確認項目 | 確認方法 |
|---|---------|---------|
| 1 | 地図が表示される | 目視確認 |
| 2 | 記録を選択すると航跡が表示される | チェック→地図確認 |
| 3 | 複数選択で複数の航跡が色分けされる | 複数チェック |
| 4 | 開始点・終了点にマーカーがある | 目視確認 |
| 5 | 航跡全体が見える位置に自動ズームされる | 選択後に確認 |
| 6 | 大量ポイントでも描画が遅くない | チェンマイ探検（6.5万ポイント）で確認 |

### 成果物
- 記録一覧 + 地図プレビューが連動するアプリ

---

## フェーズ4: GPX出力

### 目標
選択した記録をGPXファイルとして出力する

### 実装内容

- [ ] GPXフォーマット生成ロジック
- [ ] 単一出力機能（1記録 → 1ファイル）
- [ ] 結合出力機能（複数記録 → 1ファイル）
- [ ] 保存ダイアログ
- [ ] ファイル名自動生成（記録名_開始日時.gpx）
- [ ] 時刻フォーマット（ISO 8601、タイムゾーン指定子なし）
- [ ] 出力成功通知（Snackbar）
- [ ] 出力確認ダイアログ

### 確認ポイント

| # | 確認項目 | 確認方法 |
|---|---------|---------|
| 1 | 「単一出力」で1つのGPXが出力される | ボタンクリック |
| 2 | 「結合出力」で複数記録が1つのGPXになる | 複数選択→出力 |
| 3 | GPXファイルの中身が正しい | テキストエディタで確認 |
| 4 | 時刻がローカルタイム形式（Zなし）になっている | GPX内容確認 |
| 5 | ファイル名が正しく生成される | ファイル名確認 |
| 6 | 出力成功の通知が表示される | 目視確認 |
| 7 | **Lightroom Classicで読み込める** | LrCでインポート |
| 8 | **写真にジオタグが正しく付与される** | LrCで確認 |

### 成果物
- GPX出力機能を持つ完全なアプリ

---

## フェーズ5: 設定・仕上げ

### 目標
設定機能の追加とUI/UXの仕上げ

### 実装内容

- [ ] 設定ダイアログ
  - [ ] デフォルト出力先フォルダ設定
  - [ ] 出力時に毎回確認するかのオプション
- [ ] ウィンドウサイズ・位置の記憶
- [ ] 最小ウィンドウサイズ制限（1000x700）
- [ ] UIの微調整・レイアウト最適化
- [ ] エラーハンドリングの強化
- [ ] アプリアイコン設定

### 確認ポイント

| # | 確認項目 | 確認方法 |
|---|---------|---------|
| 1 | 設定ダイアログが開く | 設定ボタンクリック |
| 2 | デフォルト出力先を設定できる | フォルダ選択 |
| 3 | 設定が保存・復元される | 再起動して確認 |
| 4 | ウィンドウサイズ・位置が記憶される | リサイズ→再起動 |
| 5 | 最小サイズ以下に縮小できない | ウィンドウ縮小操作 |
| 6 | 全体的なUIが使いやすい | 一通り操作 |

### 成果物
- 完成版アプリ

---

## フェーズサマリー

| フェーズ | 内容 | 主な確認項目 |
|---------|------|-------------|
| 1 | プロジェクト基盤 | アプリ起動、ウィンドウ表示 |
| 2 | DB読み込み・一覧 | DB選択、一覧表示、ソート・フィルタ |
| 3 | 地図プレビュー | 航跡描画、自動フィット |
| 4 | GPX出力 | ファイル出力、LrC連携確認 |
| 5 | 設定・仕上げ | 設定保存、UI最適化 |

---

## 注意事項

- 各フェーズは前フェーズの承認後に開始
- フェーズ4の「Lightroom Classic連携確認」は最重要確認項目
- 問題発見時は該当フェーズ内で修正完了してから次へ

---

**作成日**: 2025年12月29日
